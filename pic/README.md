## PIC12F1822

### fan_temp.c
The purpose of this design is to use a PIC microcontroller to control the speed of a fan based on temperature. There is no sense running a fan at full voltage and wasting power, so this design allows the fan to run at a low idle speed and increase speed only as the temperature increase.

The fan has 12 speeds, including an idle speed and maximum speed. The speeds are determined by the [PWM duty cycle](https://en.wikipedia.org/wiki/Pulse-width_modulation#Principle). The idle speed is set to a duty cycle of 40%, and max speed is set to 99.6%. The speed control follows this logic: If the register value created by the [ADC](https://en.wikipedia.org/wiki/Analog-to-digital_converter) is within a certain range, then set the duty cycle register to a certain value. To conserve power and processing time, an [interrupt service routine (ISR)](https://en.wikipedia.org/wiki/Interrupt_handler) is implemented based on an internal timer (Timer0). This interrupt occurs about every 65 ms when the Timer0 register overflows. Within the ISR, the program gets the result of the ADC out of the ADRESH register (the 8 MSBs of the conversion) and puts the 8 bit value into a variable (valADC). A flag (statusIntr) is set so the main program knows that an interrupt happened and can now do PWM operations. At the end of the ISR, the GO/DONE bit is set to start the next ADC conversion. The main program will only change the PWM value after the statusIntr flag is set. It does this using an if-else-if statement to determine the range that valADC fits into. The range values were determined experimentally and are represented as 8 bit decimal values in the program. Once the correct range is found, a specific value is put into the PWM duty cycle register (CCPR1L). A conversion ratio between duty cycle and the PWM register value was found experimentally to be: Duty / CCPR1L = Conversion Factor. For example: 100 / 255 = 0.39. This means that any desired duty cycle can be divided by 0.39 to get the appropriate CCPR1L value. The PWM output modulates the fanâ€™s power and changes the speed.
